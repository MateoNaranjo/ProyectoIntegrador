<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sistema de Citas Médicas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    
    <!-- FullCalendar CSS -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css' rel='stylesheet' />

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc;
        }
        .section {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        .hero-pattern {
            background-color: #1e40af;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%234f46e5' fill-opacity='0.12'%3E%3Cpath opacity='.5' d='M96 95h4v1h-4v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9zm-1 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9z'/%3E%3Cpath d='M6 5V0H5v5H0v1h5v94h1V6h94V5H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .dropdown-menu {
            transform: scale(0.95);
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease-in-out;
        }
        .dropdown-menu.show {
            transform: scale(1);
            opacity: 1;
            visibility: visible;
        }
        .nav-link {
            transition: all 0.3s ease;
        }
        .nav-link:hover {
            background-color: #f3f4f6;
        }
        input:focus, select:focus, textarea:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        #calendar {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 1.5rem;
        }
        .fc .fc-button-primary {
            background-color: #1e40af !important;
            border-color: #1e40af !important;
        }
        .fc .fc-button-primary:hover {
            background-color: #1d4ed8 !important;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Hero Section -->
    <div class="hero-pattern">
        <div class="container mx-auto px-6 py-16">
            <div class="text-center">
                <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">Sistema de Citas Médicas</h1>
                <p class="text-xl text-blue-100 mb-8">Gestione sus citas médicas de manera fácil y eficiente</p>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white shadow-lg sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <img src="https://arcangeles.org/storage/2024/09/logo-Arcangeles.png" alt="Logo Fundación Arcángeles" class="h-14 w-auto object-contain">
                    <div class="border-l border-gray-300 h-8 mx-3"></div>
                    <h2 class="text-xl font-semibold text-gray-800">Centro Médico</h2>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="#welcome" class="bg-white text-blue-600 px-4 py-2 rounded-lg flex items-center space-x-2 hover:bg-blue-50 transition-colors border border-blue-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                        </svg>
                        <span>Volver al Inicio</span>
                    </a>
                    <button id="menuBtn" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 flex items-center space-x-2">
                        <span id="userName">Menú</span>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <div id="dropdown" class="dropdown-menu absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-xl z-50 border border-gray-100">
                        <div class="py-2">
                            <a href="#" data-target="agendar" class="nav-link flex items-center px-4 py-3 text-gray-800 hover:bg-blue-50 transition-colors duration-200">
                                <svg class="w-5 h-5 mr-3 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                Agendar Citas
                            </a>
                            <a href="#" data-target="ver" class="nav-link flex items-center px-4 py-3 text-gray-800 hover:bg-blue-50 transition-colors duration-200">
                                <svg class="w-5 h-5 mr-3 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                                Ver Citas
                            </a>
                            <a href="#" data-target="eliminar" class="nav-link flex items-center px-4 py-3 text-gray-800 hover:bg-blue-50 transition-colors duration-200">
                                <svg class="w-5 h-5 mr-3 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                                Eliminar Citas
                            </a>
                            <a href="#" id="logoutBtn" class="nav-link flex items-center px-4 py-3 text-red-600 hover:bg-red-50 transition-colors duration-200">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                </svg>
                                Cerrar Sesión
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-8">

        <!-- === INICIO CON CALENDARIO === -->
        <section id="welcome" class="section active">
            <div class="max-w-7xl mx-auto">
                <!-- Título + Calendario -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
                    <div class="bg-gradient-to-r from-blue-600 to-blue-800 p-12 text-center">
                        <h2 class="text-4xl md:text-5xl font-bold text-white mb-4">Centro Médico Especializado</h2>
                        <p class="text-xl text-blue-100">Cuidando de su salud con profesionalismo y dedicación</p>
                    </div>
                    <div class="p-6 bg-gray-50">
                        <div id="calendar"></div>
                    </div>
                </div>

                <!-- Especialidades -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="bg-gradient-to-br from-green-500 to-green-600 p-4">
                            <h3 class="text-xl font-bold text-white text-center">Medicina General</h3>
                        </div>
                        <div class="p-6">
                            <ul class="space-y-3 text-gray-600">
                                <li class="flex items-center"><svg class="w-5 h-5 mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Consulta General</li>
                                <li class="flex items-center"><svg class="w-5 h-5 mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Control de Salud</li>
                                <li class="flex items-center"><svg class="w-5 h-5 mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Certificados Médicos</li>
                            </ul>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-4">
                            <h3 class="text-xl font-bold text-white text-center">Especialidades</h3>
                        </div>
                        <div class="p-6">
                            <ul class="space-y-3 text-gray-600">
                                <li class="flex items-center"><svg class="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Cardiología</li>
                                <li class="flex items-center"><svg class="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Pediatría</li>
                                <li class="flex items-center"><svg class="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Traumatología</li>
                            </ul>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 p-4">
                            <h3 class="text-xl font-bold text-white text-center">Servicios Adicionales</h3>
                        </div>
                        <div class="p-6">
                            <ul class="space-y-3 text-gray-600">
                                <li class="flex items-center"><svg class="w-5 h-5 mr-2 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Laboratorio Clínico</li>
                                <li class="flex items-center"><svg class="w-5 h-5 mr-2 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Radiografías</li>
                                <li class="flex items-center"><svg class="w-5 h-5 mr-2 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Ecografías</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Contacto y Horario -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 p-4">
                            <h3 class="text-xl font-bold text-white text-center">Información de Contacto</h3>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4">
                                <div class="flex items-center">
                                    <svg class="w-6 h-6 text-indigo-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                    </svg>
                                    <div>
                                        <p class="text-sm text-gray-500">Teléfono Principal</p>
                                        <p class="text-lg font-semibold text-gray-800">+123 456 789</p>
                                    </div>
                                </div>
                                <div class="flex items-center">
                                    <svg class="w-6 h-6 text-indigo-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                    <div>
                                        <p class="text-sm text-gray-500">Correo Electrónico</p>
                                        <p class="text-lg font-semibold text-gray-800">contacto@centromedico.com</p>
                                    </div>
                                </div>
                                <div class="flex items-center">
                                    <svg class="w-6 h-6 text-indigo-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    <div>
                                        <p class="text-sm text-gray-500">Dirección</p>
                                        <p class="text-lg font-semibold text-gray-800">Av. Principal #123</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="bg-gradient-to-br from-teal-500 to-teal-600 p-4">
                            <h3 class="text-xl font-bold text-white text-center">Horario de Atención</h3>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4">
                                <div class="text-center p-4 bg-teal-50 rounded-lg">
                                    <h4 class="font-medium text-gray-800 mb-2">Lunes a Viernes</h4>
                                    <p class="text-teal-600 font-semibold">8:00 AM - 6:00 PM</p>
                                </div>
                                <div class="text-center p-4 bg-teal-50 rounded-lg">
                                    <h4 class="font-medium text-gray-800 mb-2">Sábados</h4>
                                    <p class="text-teal-600 font-semibold">8:00 AM - 2:00 PM</p>
                                </div>
                                <div class="text-center mt-4">
                                    <p class="text-sm text-gray-600">Emergencias 24/7</p>
                                    <p class="text-lg font-semibold text-teal-600">+123 456 789</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- === AGENDAR CITAS === -->
        <section id="agendar" class="section">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-green-500 to-green-600 p-8">
                        <h2 class="text-3xl font-bold text-white mb-2">Agendar Nueva Cita</h2>
                        <p class="text-green-100 text-lg">Complete el formulario para agendar su cita médica</p>
                    </div>
                    <div class="p-8">
                        <form id="formCita" class="space-y-8">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Cita</label>
                                    <select name="tipoCita" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 bg-white shadow-sm" required>
                                        <option value="">Seleccione el tipo de cita</option>
                                        <option value="Primera Vez">Primera Vez</option>
                                        <option value="Control">Control</option>
                                        <option value="Urgencia">Urgencia</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Especialidad</label>
                                    <select name="especialidad" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 bg-white shadow-sm" required>
                                        <option value="">Seleccione una especialidad</option>
                                        <option value="Cardiología">Cardiología</option>
                                        <option value="Dermatología">Dermatología</option>
                                        <option value="Pediatría">Pediatría</option>
                                        <option value="Neurología">Neurología</option>
                                        <option value="Oftalmología">Oftalmología</option>
                                        <option value="Traumatología">Traumatología</option>
                                    </select>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Fecha Preferida</label>
                                    <input type="date" name="fecha" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 bg-white shadow-sm" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Hora Preferida</label>
                                    <input type="time" name="hora" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 bg-white shadow-sm" required>
                                </div>
                            </div>
                            <div class="space-y-6">
                                <h3 class="text-lg font-medium text-gray-900">Información del Paciente</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <input type="text" name="nombreCompleto" placeholder="Nombre Completo" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 bg-white shadow-sm" required>
                                    <input type="text" name="documentoIdentidad" placeholder="Documento de Identidad" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 bg-white shadow-sm" required>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <input type="tel" name="telefono" placeholder="Teléfono" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 bg-white shadow-sm">
                                    <input type="email" name="correo" placeholder="correo@ejemplo.com" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 bg-white shadow-sm">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Motivo de la Consulta</label>
                                <textarea name="motivo" rows="4" placeholder="Describa brevemente el motivo de su consulta" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 bg-white shadow-sm"></textarea>
                            </div>
                            <div class="flex justify-end space-x-4">
                                <button type="button" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50">Cancelar</button>
                                <button type="submit" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700">Agendar Cita</button>
                            </div>
                            <div id="mensajeCita" class="mt-4 text-center font-medium"></div>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- === VER CITAS === -->
        <section id="ver" class="section">
            <div class="max-w-6xl mx-auto">
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-8">
                        <h2 class="text-3xl font-bold text-white mb-2">Citas Agendadas</h2>
                        <p class="text-blue-100 text-lg">Visualiza y gestiona todas tus citas programadas</p>
                    </div>
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <div class="flex space-x-4">
                                <button class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">Todas</button>
                                <button class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">Próximas</button>
                                <button class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">Pasadas</button>
                            </div>
                            <input type="text" placeholder="Buscar cita..." class="w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div id="citasContainer">
                            <p class="text-center text-gray-500">Cargando citas...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- === ELIMINAR CITAS === -->
        <section id="eliminar" class="section">
            <div class="max-w-6xl mx-auto">
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-red-500 to-red-600 p-8">
                        <h2 class="text-3xl font-bold text-white mb-2">Eliminar Citas</h2>
                        <p class="text-red-100 text-lg">Gestiona y cancela tus citas programadas</p>
                    </div>
                    <div class="p-6">
                        <div class="mb-6">
                            <input type="text" placeholder="Buscar cita para cancelar..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                        </div>
                        <div id="eliminarContainer">
                            <p class="text-center text-gray-500">Cargando citas...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- FullCalendar JS -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('token');
            if (!token) {
                alert('Debes iniciar sesión');
                window.location.href = 'index.html';
                return;
            }

            // Intentar extraer nombre del token (evita depender de /api/usuario)
            function getUserFromToken(t) {
                try {
                    const payload = t.split('.')[1];
                    const decoded = JSON.parse(atob(payload));
                    return decoded; // { id, nombre, tipo }
                } catch (e) { return null; }
            }

            const user = getUserFromToken(token);
            if (user && user.nombre) document.getElementById('userName').textContent = user.nombre;

            // Cerrar sesión
            document.getElementById('logoutBtn')?.addEventListener('click', (e) => {
                e?.preventDefault();
                localStorage.removeItem('token');
                window.location.href = 'index.html';
            });

            // Normalizador de campos (maneja mayúsculas/minúsculas devueltas por MySQL)
            function f(obj, ...keys) {
                for (const k of keys) {
                    if (obj == null) break;
                    if (k in obj) return obj[k];
                    const alt = Object.keys(obj).find(x => x.toLowerCase() === k.toLowerCase());
                    if (alt) return obj[alt];
                }
                return undefined;
            }

            // === CALENDARIO ===
            let calendar = null;
            function inicializarCalendario() {
                const calendarEl = document.getElementById('calendar');
                if (!calendarEl || calendar) return;
                calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    locale: 'es',
                    headerToolbar: { left: 'prev,next today', center: 'title', right: 'dayGridMonth,timeGridWeek,timeGridDay' },
                    buttonText: { today: 'Hoy', month: 'Mes', week: 'Semana', day: 'Día' },
                    events: [],
                    eventClick: function(info) { alert(`Cita: ${info.event.title}\nHora: ${info.event.start.toLocaleString()}`); }
                });
                calendar.render();
                actualizarCalendario();
            }

            const welcomeLink = document.querySelector('[href="#welcome"]');
            if (welcomeLink) welcomeLink.addEventListener('click', () => setTimeout(inicializarCalendario, 400));
            if (document.getElementById('welcome')?.classList.contains('active')) setTimeout(inicializarCalendario, 400);

            // === FUNCIONES DE CITAS ===
            async function actualizarCalendario() {
                if (!calendar) return;
                try {
                    const res = await fetch('/api/mis-citas', { headers: { 'Authorization': `Bearer ${token}` } });
                    if (!res.ok) return;
                    const citas = await res.json();
                    calendar.removeAllEvents();
                        // Log para depuración: mostrar lo que viene del backend
                        console.debug('Citas recibidas para calendario:', citas);
                        const events = citas.map(c => {
                            const esp = f(c, 'especialidad', 'Nombre_Especialidad', 'Nombre_Esp');
                            const nombre = f(c, 'nombre_completo', 'Nombre_Completo') || `${f(c, 'Nombre_Doctor') || ''}`;
                            const fecha = f(c, 'fecha', 'Fecha');
                            const hora = f(c, 'hora', 'Hora');
                            const tipo = f(c, 'tipo_cita', 'Tipo_Cita') || '';
                            // Normalizar start: si falta hora, usar fecha sola; si falta fecha intentar con campo raw.Fecha
                            let start = null;
                            if (fecha) {
                                if (hora) {
                                    // Asegurar que hora tiene formato HH:MM[:SS]
                                    const horaNorm = hora.length === 5 ? `${hora}:00` : hora;
                                    start = `${fecha}T${horaNorm}`;
                                } else {
                                    start = fecha;
                                }
                            } else if (c && c.raw && c.raw.Fecha) {
                                start = c.raw.Fecha;
                            }
                            return {
                                title: `${esp || 'Cita'} - ${nombre}`,
                                start,
                                backgroundColor: (tipo && tipo.toLowerCase() === 'urgencia') ? '#ef4444' : '#3b82f6'
                            };
                        });
                    calendar.addEventSource(events);
                } catch (err) { console.error('Error actualizarCalendario', err); }
            }

            async function cargarCitas() {
                try {
                    const res = await fetch('/api/mis-citas', { headers: { 'Authorization': `Bearer ${token}` } });
                    if (!res.ok) { document.getElementById('citasContainer').innerHTML = '<p class="text-center text-red-600">Error al cargar</p>'; return; }
                    const citasRaw = await res.json();
                    const citas = citasRaw.map(c => ({
                        id: f(c, 'Id_cita', 'id_cita', 'id'),
                        especialidad: f(c, 'especialidad', 'Nombre_Especialidad', 'Nombre_Esp'),
                        fecha: f(c, 'fecha', 'Fecha'),
                        hora: f(c, 'hora', 'Hora'),
                        nombre_completo: f(c, 'nombre_completo', 'Nombre_Completo') || `${f(c, 'Nombre_Doctor') || ''}`
                    }));

                    const html = citas.length === 0
                        ? '<p class="text-center text-gray-500">No tienes citas agendadas</p>'
                        : `
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Especialidad</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Fecha</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Hora</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Paciente</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estado</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${citas.map(c => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 text-sm font-medium text-gray-900">${c.especialidad || ''}</td>
                                            <td class="px-6 py-4 text-sm text-gray-900">${c.fecha ? new Date(c.fecha).toLocaleDateString('es-CO') : ''}</td>
                                            <td class="px-6 py-4 text-sm text-gray-900">${c.hora || ''}</td>
                                            <td class="px-6 py-4 text-sm text-gray-900">${c.nombre_completo || ''}</td>
                                            <td class="px-6 py-4"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Confirmada</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>`;
                    document.getElementById('citasContainer').innerHTML = html;
                } catch (err) { console.error(err); document.getElementById('citasContainer').innerHTML = '<p class="text-center text-red-600">Error al cargar</p>'; }
            }

            async function cargarEliminar() {
                try {
                    const res = await fetch('/api/mis-citas', { headers: { 'Authorization': `Bearer ${token}` } });
                    if (!res.ok) { document.getElementById('eliminarContainer').innerHTML = '<p class="text-center text-red-600">Error al cargar</p>'; return; }
                    const citasRaw = await res.json();
                    const citas = citasRaw.map(c => ({
                        id: f(c, 'Id_cita', 'id_cita', 'id'),
                        especialidad: f(c, 'especialidad', 'Nombre_Especialidad', 'Nombre_Esp'),
                        fecha: f(c, 'fecha', 'Fecha'),
                        hora: f(c, 'hora', 'Hora'),
                        nombre_completo: f(c, 'nombre_completo', 'Nombre_Completo') || `${f(c, 'Nombre_Doctor') || ''}`
                    }));

                    const html = citas.length === 0
                        ? '<p class="text-center text-gray-500">No tienes citas para eliminar</p>'
                        : `
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Especialidad</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Fecha</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Hora</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Paciente</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Acción</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${citas.map(c => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 text-sm font-medium text-gray-900">${c.especialidad || ''}</td>
                                            <td class="px-6 py-4 text-sm text-gray-900">${c.fecha ? new Date(c.fecha).toLocaleDateString('es-CO') : ''}</td>
                                            <td class="px-6 py-4 text-sm text-gray-900">${c.hora || ''}</td>
                                            <td class="px-6 py-4 text-sm text-gray-900">${c.nombre_completo || ''}</td>
                                            <td class="px-6 py-4">
                                                <button onclick="eliminarCita(${c.id})" class="inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-md">
                                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                                    Cancelar
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>`;
                    document.getElementById('eliminarContainer').innerHTML = html;
                } catch (err) { console.error(err); document.getElementById('eliminarContainer').innerHTML = '<p class="text-center text-red-600">Error al cargar</p>'; }
            }

            window.eliminarCita = async (id) => {
                if (!confirm('¿Eliminar esta cita?')) return;
                try {
                    const res = await fetch(`/api/cita/${id}`, { method: 'DELETE', headers: { 'Authorization': `Bearer ${token}` } });
                    const result = await res.json();
                    alert(result.success ? 'Cita eliminada' : result.error || 'No se pudo eliminar');
                    cargarCitas(); cargarEliminar(); actualizarCalendario();
                } catch (err) { alert('Error al eliminar'); }
            };

            // Agendar cita
            document.getElementById('formCita')?.addEventListener('submit', async (e) => {
                e.preventDefault();
                const data = Object.fromEntries(new FormData(e.target));
                const mensaje = document.getElementById('mensajeCita');
                try {
                    const res = await fetch('/api/agendar-cita', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` }, body: JSON.stringify(data) });
                    const result = await res.json();
                    mensaje.textContent = result.success ? `${result.message} (ID: ${result.id_cita || result.insertId || ''})` : result.error || result.message || 'Error';
                    mensaje.className = result.success ? 'text-green-600' : 'text-red-600';
                    if (result.success) { e.target.reset(); cargarCitas(); cargarEliminar(); actualizarCalendario(); }
                } catch (err) { mensaje.textContent = 'Error de conexión'; mensaje.className = 'text-red-600'; }
            });

            // Cargar al abrir secciones
            document.querySelector('[data-target="ver"]')?.addEventListener('click', () => { cargarCitas(); actualizarCalendario(); });
            document.querySelector('[data-target="eliminar"]')?.addEventListener('click', cargarEliminar);

            // === NAVEGACIÓN ORIGINAL ===
            const menuBtn = document.getElementById('menuBtn');
            const dropdown = document.getElementById('dropdown');
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.nav-link');

            document.querySelectorAll('[data-target], [href^="#"]').forEach(el => {
                el.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = this.getAttribute('data-target') || this.getAttribute('href').substring(1);
                    if (target && document.getElementById(target)) { showSection(target); dropdown.classList.remove('show'); }
                });
            });

            menuBtn?.addEventListener('click', e => { e.stopPropagation(); dropdown.classList.toggle('show'); });
            document.addEventListener('click', e => { if (!menuBtn?.contains(e.target) && !dropdown?.contains(e.target)) dropdown.classList.remove('show'); });

            function showSection(id) {
                sections.forEach(s => { if (s.classList.contains('active')) { s.style.opacity = '0'; s.style.transform = 'translateY(20px)'; setTimeout(() => s.classList.remove('active'), 300); } });
                setTimeout(() => { const target = document.getElementById(id); if (target) { target.classList.add('active'); setTimeout(() => { target.style.opacity = '1'; target.style.transform = 'translateY(0)'; }, 50); } }, 300);
            }

            navLinks.forEach(link => { link.addEventListener('click', function(e) { e.preventDefault(); const id = this.getAttribute('data-target'); navLinks.forEach(l => l.classList.remove('bg-gray-100')); this.classList.add('bg-gray-100'); showSection(id); dropdown.classList.remove('show'); }); });

        });
    </script>
</body>
</html>
